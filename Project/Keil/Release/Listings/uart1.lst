C51 COMPILER V9.60.7.0   UART1                                                             11/11/2024 17:29:25 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE UART1
OBJECT MODULE PLACED IN .\Release\Objects\uart1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\Hardware\uart1.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\
                    -Listings\uart1.lst) OBJECT(.\Release\Objects\uart1.obj)

line level    source

   1          #include "uart1.h"
   2          
   3          #define UART1_BAUD (115200UL)
   4          #define USER_UART1_BAUD ((SYSCLK - UART1_BAUD) / (UART1_BAUD))
   5          
   6          #define PROTOCOL_HEAD ((u8)0xA5) // 协议头
   7          #define PROTOCOL_TAIL ((u8)0x5A) // 协议尾
   8          
   9          enum
  10          {
  11              CUR_RECV_STATUS_NONE = 0,    // 无状态，默认状态
  12              CUR_RECV_STATUS_BEGIN,   // 开始接收
  13              CUR_RECV_STATUS_RECVING, // 接收数据中
  14              CUR_RECV_STATUS_END,     // 结束接收
  15          };
  16          volatile u8 flag_cur_recv_status = CUR_RECV_STATUS_NONE; // 当前接收的状态(作为状态机)
  17          
  18          u8 instruction_seg1 = 0;
  19          
  20          // u8 uart1_recv_buf[6] = {0};
  21          
  22          void uart1_config(void)
  23          {
  24   1          P1_MD0 &= ~(GPIO_P11_MODE_SEL(0x3)); // 配置为输入模式
  25   1          FIN_S8 |= GPIO_FIN_SEL_P12;          // uart1_rx 输入功能 pin 脚选择
  26   1      
  27   1          __EnableIRQ(UART1_IRQn); // 打开UART模块中断
  28   1          IE_EA = 1;               // 打开总中断
  29   1      
  30   1          UART1_BAUD1 = (USER_UART1_BAUD >> 8) & 0xFF; // 配置波特率高八位
  31   1          UART1_BAUD0 = USER_UART1_BAUD & 0xFF;        // 配置波特率低八位
  32   1          UART1_CON0 = UART_STOP_BIT(0x0) |            // 8bit数据，1bit停止位，使能中断
  33   1                       UART_RX_IRQ_EN(0x1) |
  34   1                       UART_EN(0x1);
  35   1      }
  36          
  37          void UART1_IRQHandler(void) interrupt UART1_IRQn
  38          {
  39   1          u8 uart_data = 0;
  40   1      
  41   1          // 进入中断设置IP，不可删除
  42   1          __IRQnIPnPush(UART1_IRQn);
  43   1      
  44   1          // ---------------- 用户函数处理 -------------------
  45   1      
  46   1          // RX接收完成中断
  47   1          if (UART1_STA & UART_RX_DONE(0x1))
  48   1          {
  49   2              uart_data = UART1_DATA;
  50   2      
  51   2              if (flag_cur_recv_status == CUR_RECV_STATUS_NONE && uart_data == 0xA5)
  52   2              {
  53   3      
C51 COMPILER V9.60.7.0   UART1                                                             11/11/2024 17:29:25 PAGE 2   

  54   3              }
  55   2          }
  56   1      
  57   1          // 退出中断设置IP，不可删除
  58   1          __IRQnIPnPop(UART1_IRQn);
  59   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     63    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
