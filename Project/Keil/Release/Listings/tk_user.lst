C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TK_USER
OBJECT MODULE PLACED IN .\Release\Objects\tk_user.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\tk_user.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR(0X000C) IN
                    -CDIR(..\..\Libraries\Include;..\..\Hardware;..\..\User;..\..\User\lib) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Li
                    -stings\tk_user.lst) OBJECT(.\Release\Objects\tk_user.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    User/tk_user.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-20-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2022 TAIXIN-IC</center></h2>
  12           *
  13           *
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include <stdio.h>
  20          #include "include.h"
  21          #include "my_config.h"
  22          
  23          /** @addtogroup Template_Project
  24           * @{
  25           */
  26          
  27          /* Private typedef -----------------------------------------------------------*/
  28          /* Private define ------------------------------------------------------------*/
  29          /* Private macro -------------------------------------------------------------*/
  30          /* Private variables ---------------------------------------------------------*/
  31          /* Private function prototypes -----------------------------------------------*/
  32          /* Private functions ---------------------------------------------------------*/
  33          
  34          /**
  35           * @brief  Touchkey  debug uart init function
  36           * @param  None
  37           * @retval None
  38           */
  39          // // xdata u16 led_data[1];                           // LEDÏÔÊ¾buff
  40          // #define LED_DIS_FREQ (1000000 / 16 / 8 / 60 - 1) // Ò»¸öCONµÄÏÔÊ¾Ê±¼ä60Hz    60-1=1M/(LED_COMCON*16*LED
             -_TIME_CON)
  41          
  42          // unsigned int xdata display_data = 0;
  43          
  44          /**
  45           * @brief  µ÷ÊÔ½Ó¿ÚIO³õÊ¼»¯º¯Êý.
  46           * @param  None
  47           * @retval None
  48           */
  49          #if TK_DEBUG_EN
              void debug_gpio_config(void)
              {
              #if 1
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 2   

                  P2_MD0 &= ~GPIO_P21_MODE_SEL(0x03);
                  P2_MD0 |= GPIO_P21_MODE_SEL(0x01);
                  FOUT_S21 = GPIO_FOUT_UART1_TX;
              #else
                  P2_MD1 &= ~GPIO_P27_MODE_SEL(0x03);
                  P2_MD1 |= GPIO_P27_MODE_SEL(0x01);
                  FOUT_S27 = GPIO_FOUT_UART1_TX;
              #endif
              }
              #endif
  63          
  64          #if 0
              /**
               * @brief  ÓÃ»§´úÂëÑ­»·Ö´ÐÐº¯Êý½Ó¿Ú.£¨´¥Ãþ°´¼üÉ¨Ãèº¯Êý½Ó¿Ú£©
               * @param  None
               * @retval None
               */
              #define DETECT_DOUBLE_CLICK_INTERVAL (100) // ·¢ËÍ¼ä¸ô
              void user_handle(void)
              {
                  volatile unsigned long int touch_key = __tk_key_flag; // __tk_key_flagµ¥´Î°´¼ü±êÖ¾
              
                  static volatile unsigned long int KeyOld = 0; // ÓÃÓÚ´æ·Å³¤°´Ê±£¬¶ÔÓ¦µÄ°´¼ü
              
                  // ÊÇ·ñ³¤°´µÄ±êÖ¾£¬0--·ñ£¬1--ÊÇ
                  // ÐèÒª±£´æ³¤°´µÄ×´Ì¬£¬±íÊ¾¶¨Ê±Æ÷Ò»Ö±ÔÚ·¢ËÍ¼üÖµ
                  static unsigned char flag_is_long_press = 0; // ÉÏÒ»´ÎÉ¨Ãèµ½µÄ°´¼üÊÇ·ñÎª³¤°´µÄ±êÖ¾
              
                  static volatile u32 cnt = 0; // ³¤°´¼ÆÊýÖµ
              
                  u32 i = 0; // Ñ­»·¼ÆÊýÖµ
              
                  u16 send_data = 0; // Òª·¢ËÍµÄ´øÓÐ¼üÖµµÄÊý¾Ý
              
                  if (touch_key && 0 == flag_is_long_press && cnt < TK_LONG_KEY_TIME) // Èç¹ûÓÐ°´¼ü°´ÏÂ£¨²¢ÇÒÖ®Ç°É¨Ãèµ½µ
             -Ä²»ÊÇ³¤°´£©
                  {
                      // Í¨¹ýÑ­»·ÅÐ¶ÏÊÇ·ñÎª³¤°´
                      for (i = 0; i < 500000; i++) // Êµ¼ÊÉÏÓÃ²»µ½ÕâÃ´´óµÄÊý×Ö£¬µ½ÁËÉè¶¨µÄ³¤°´Ê±¼ä¾Í»áÍË³ö
                      {
                          // °´¼üÉ¨Ãèº¯Êý£¬Ê¹ÓÃÁË¿âÀïÃæµÄ½Ó¿Ú£¨±ÕÔ´¿â£©
                          // Õâ¸öº¯Êý»á¸üÐÂ__tk_key_flagµÄÖµ
                          delay_ms(10);
                          __tk_scan();
              
                          if (touch_key == __tk_key_flag)
                          {
                              // Èç¹û°´¼ü¼üÖµÒ»ÖÂ£¬ËµÃ÷°´¼üÒ»Ö±±»°´ÏÂ£¬Î´ËÉ¿ª
                              cnt++;
                          }
                          else
                          {
                              // Èç¹û°´¼ü¼üÖµ²»Ò»ÖÂ»òÊÇËÉ¿ªÁË°´¼ü
                              // cnt = 0;
                              break;
                          }
                          
                          if (cnt > TK_LONG_KEY_TIME) // Èç¹û³¤°´³¬¹ýÁËÕâÀïÉèÖÃµÄÊ±¼ä
                          {
                              flag_is_long_press = 1; // ±ê¼ÇÎª³¤°´
                              break;
                          }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 3   

                      }
              
                      if (cnt > TK_LONG_KEY_TIME)
                      {
                          flag_is_long_press = 1; // ±ê¼ÇÎª³¤°´
                      }
                      else
                      {
                          // Èç¹ûÊÇ¶Ì°´
                          cnt = 0; // Çå³ý³¤°´µÄ¼ÆÊýÖµ
              
                          // ÅÐ¶Ïµ±Ç°´¥ÃþµÄ¼üÖµ£¬×ö¶ÔÓ¦µÄ²Ù×÷
                          if (TK_CH24_VALIB == touch_key)
                          {
                              // Èç¹ûKEY1±»´¥Ãþ
                              for (i = 0; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                              {
                                  delay_ms(1);
                                  __tk_scan();
                                  touch_key = __tk_key_flag;
              
                                  if (TK_CH24_VALIB == touch_key)
                                  {
                                      // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
                                      // µÈ´ýÊÖÖ¸ËÉ¿ª°´¼ü£¬²»È»·¢ËÍÍê´øÓÐË«»÷×´Ì¬µÄ¼üÖµºó»áÔÙ·¢ËÍÒ»´Îµ¥»÷×´Ì¬µÄ¼üÖµ
                                      while (0 != touch_key)
                                      {
                                          __tk_scan();
                                          touch_key = __tk_key_flag;
                                      }
              #if USE_MY_DEBUG
                                      printf("k1 double press\n");
              #endif
                                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY1);
                                      return;
                                  }
                              }
              
              // Èç¹û²»ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ»òÊÇÃ»ÓÐÖµ£¬ËµÃ÷ÊÇ¶Ì°´
              #if USE_MY_DEBUG
                              printf("k1 press\n");
              #endif
                              send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY1); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
                          }
                          else if (TK_CH25_VALIB == touch_key)
                          {
                              // Èç¹ûKEY2±»´¥Ãþ
                              for (i = 0; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                              {
                                  delay_ms(1);
                                  __tk_scan();
                                  touch_key = __tk_key_flag;
              
                                  if (TK_CH25_VALIB == touch_key)
                                  {
                                      // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
                                      // µÈ´ýÊÖÖ¸ËÉ¿ª°´¼ü£¬²»È»·¢ËÍÍê´øÓÐË«»÷×´Ì¬µÄ¼üÖµºó»áÔÙ·¢ËÍÒ»´Îµ¥»÷×´Ì¬µÄ¼üÖµ
                                      while (0 != touch_key)
                                      {
                                          __tk_scan();
                                          touch_key = __tk_key_flag;
                                      }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 4   

              #if USE_MY_DEBUG
                                      printf("k2 double press\n");
              #endif
                                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY2);
                                      return;
                                  }
                              }
              
              // Èç¹û²»ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ»òÊÇÃ»ÓÐÖµ£¬ËµÃ÷ÊÇ¶Ì°´
              #if USE_MY_DEBUG
                              printf("k2 press\n");
              #endif
                              send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY2); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
                          }
                          else if (TK_CH23_VALIB == touch_key)
                          {
                              // Èç¹ûKEY3±»´¥Ãþ
                              for (i = 0; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                              {
                                  delay_ms(1);
                                  __tk_scan();
                                  touch_key = __tk_key_flag;
              
                                  if (TK_CH23_VALIB == touch_key)
                                  {
                                      // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
                                      // µÈ´ýÊÖÖ¸ËÉ¿ª°´¼ü£¬²»È»·¢ËÍÍê´øÓÐË«»÷×´Ì¬µÄ¼üÖµºó»áÔÙ·¢ËÍÒ»´Îµ¥»÷×´Ì¬µÄ¼üÖµ
                                      while (0 != touch_key)
                                      {
                                          __tk_scan();
                                          touch_key = __tk_key_flag;
                                      }
              
              #if USE_MY_DEBUG
                                      printf("k3 double press\n");
              #endif
                                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY3);
                                      return;
                                  }
                              }
              
                              // Èç¹û²»ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ»òÊÇÃ»ÓÐÖµ£¬ËµÃ÷ÊÇ¶Ì°´
              #if USE_MY_DEBUG
                              printf("k3 press\n");
              #endif
                              send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY3); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
                          }
                          else if (TK_CH17_VALIB == touch_key)
                          {
                              // Èç¹ûKEY4±»´¥Ãþ
                              for (i = 0; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                              {
                                  delay_ms(1);
                                  __tk_scan();
                                  touch_key = __tk_key_flag;
              
                                  if (TK_CH17_VALIB == touch_key)
                                  {
                                      // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
                                      // µÈ´ýÊÖÖ¸ËÉ¿ª°´¼ü£¬²»È»·¢ËÍÍê´øÓÐË«»÷×´Ì¬µÄ¼üÖµºó»áÔÙ·¢ËÍÒ»´Îµ¥»÷×´Ì¬µÄ¼üÖµ
                                      while (0 != touch_key)
                                      {
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 5   

                                          __tk_scan();
                                          touch_key = __tk_key_flag;
                                      }
              
              #if USE_MY_DEBUG
                                      printf("k4 double press\n");
              #endif
                                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY4);
                                      return;
                                  }
                              }
              
                              // Èç¹û²»ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ»òÊÇÃ»ÓÐÖµ£¬ËµÃ÷ÊÇ¶Ì°´
              #if USE_MY_DEBUG
                              printf("k4 press\n");
              #endif
                              send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY4); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
                          }
                          else if (TK_CH15_VALIB == touch_key)
                          {
                              // Èç¹ûKEY5±»´¥Ãþ
                              for (i = 0; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
                              {
                                  delay_ms(1);
                                  __tk_scan();
                                  touch_key = __tk_key_flag;
              
                                  if (TK_CH15_VALIB == touch_key)
                                  {
                                      // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
                                      // µÈ´ýÊÖÖ¸ËÉ¿ª°´¼ü£¬²»È»·¢ËÍÍê´øÓÐË«»÷×´Ì¬µÄ¼üÖµºó»áÔÙ·¢ËÍÒ»´Îµ¥»÷×´Ì¬µÄ¼üÖµ
                                      while (0 != touch_key)
                                      {
                                          __tk_scan();
                                          touch_key = __tk_key_flag;
                                      }
              #if USE_MY_DEBUG
                                      printf("k5 double press\n");
              #endif
                                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY5);
                                      return;
                                  }
                              }
              
              // Èç¹û²»ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ»òÊÇÃ»ÓÐÖµ£¬ËµÃ÷ÊÇ¶Ì°´
              #if USE_MY_DEBUG
                              printf("k5 press\n");
              #endif
                              send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY5); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
                          }
                      }
                  }
              
                  if (1 == flag_is_long_press && 0 != touch_key)
                  {
                      KeyOld = touch_key;
              
                      // Èç¹ûÖ®Ç°ÊÇ³¤°´£¬ÏÖÔÚ»¹Î´ËÉ¿ª
                      // ÅÐ¶Ïµ±Ç°´¥ÃþµÄ¼üÖµ£¬×ö¶ÔÓ¦µÄ²Ù×÷
                      if (TK_CH24_VALIB == touch_key)
                      {
                          // Èç¹ûKEY1±»´¥Ãþ
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 6   

                          if (cnt >= TK_LONG_KEY_TIME && cnt < 90)
                          {
              #if USE_MY_DEBUG
                              printf("k1 long press\n");
              #endif
                              send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY1);
                          }
              
                          // Èô»¹²»ËÉ¿ªÊÖ£¬ÔòÃ¿¸ô150ms·¢ËÍÒ»´Î´øÓÐ³ÖÐø×´Ì¬ÐÅÏ¢µÄ¼üÖµÐÅºÅ
                          while (0 != touch_key)
                          {
                              delay_ms(10);
                              cnt++;
                              __tk_scan();
                              touch_key = __tk_key_flag;
              
                              if (cnt >= 87) // Ô­±¾ÊÇÌî90µÄ£¬µ«ÊÇÈí¼þÑÓÊ±ÓÐÎó²î£¬ÕâÀïÖ»ÄÜÂýÂýµ÷ÊÔ
                              {
                                  cnt = TK_LONG_KEY_TIME;
              #if USE_MY_DEBUG
                                  printf("k1 continue press\n");
              #endif
                                  send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY1);
                              }
                          }
                      }
                      else if (TK_CH25_VALIB == touch_key)
                      {
                          // Èç¹ûKEY2±»´¥Ãþ
                          if (cnt >= TK_LONG_KEY_TIME && cnt < 90)
                          {
              #if USE_MY_DEBUG
                              printf("k2 long press\n");
              #endif
                              send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY2);
                          }
              
                          // Èô»¹²»ËÉ¿ªÊÖ£¬ÔòÃ¿¸ô150ms·¢ËÍÒ»´Î´øÓÐ³ÖÐø×´Ì¬ÐÅÏ¢µÄ¼üÖµÐÅºÅ
                          while (0 != touch_key)
                          {
                              delay_ms(10);
                              cnt++;
                              __tk_scan();
                              touch_key = __tk_key_flag;
              
                              if (cnt >= 87) // Ô­±¾ÊÇÌî90µÄ£¬µ«ÊÇÈí¼þÑÓÊ±ÓÐÎó²î£¬ÕâÀïÖ»ÄÜÂýÂýµ÷ÊÔ
                              {
                                  cnt = TK_LONG_KEY_TIME;
              #if USE_MY_DEBUG
                                  printf("k2 continue press\n");
              #endif
                                  send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY2);
                              }
                          }
              
                          // display_data ^= 0x0200; // ¶ÔÓ¦µÄLED×´Ì¬È¡·´£¬ºóÃæ»áµ÷ÓÃled_display()Ë¢ÐÂ
                          // led_display();          // LED×´Ì¬¸üÐÂÏÔÊ¾
                      }
                      else if (TK_CH23_VALIB == touch_key)
                      {
                          // Èç¹ûKEY3±»´¥Ãþ
                          if (cnt >= TK_LONG_KEY_TIME && cnt < 90)
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 7   

                          {
              #if USE_MY_DEBUG
                              printf("k3 long press\n");
              #endif
                              send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY3);
                          }
              
                          // Èô»¹²»ËÉ¿ªÊÖ£¬ÔòÃ¿¸ô150ms·¢ËÍÒ»´Î´øÓÐ³ÖÐø×´Ì¬ÐÅÏ¢µÄ¼üÖµÐÅºÅ
                          while (0 != touch_key)
                          {
                              delay_ms(10);
                              cnt++;
                              __tk_scan();
                              touch_key = __tk_key_flag;
              
                              if (cnt >= 87) // Ô­±¾ÊÇÌî90µÄ£¬µ«ÊÇÈí¼þÑÓÊ±ÓÐÎó²î£¬ÕâÀïÖ»ÄÜÂýÂýµ÷ÊÔ
                              {
                                  cnt = TK_LONG_KEY_TIME;
              #if USE_MY_DEBUG
                                  printf("k3 continue press\n");
              #endif
                                  send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY3);
                              }
                          }
                      }
                      else if (TK_CH17_VALIB == touch_key)
                      {
                          // Èç¹ûKEY4±»´¥Ãþ
                          if (cnt >= TK_LONG_KEY_TIME && cnt < 90)
                          {
                              // display_data ^= 0x0800; // ¶ÔÓ¦µÄLED×´Ì¬È¡·´£¬ºóÃæ»áµ÷ÓÃled_display()Ë¢ÐÂ
                              // led_display();          // LED×´Ì¬¸üÐÂÏÔÊ¾
              #if USE_MY_DEBUG
                              printf("k4 long press\n");
              #endif
                              send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY4);
                          }
              
                          // Èô»¹²»ËÉ¿ªÊÖ£¬ÔòÃ¿¸ô150ms·¢ËÍÒ»´Î´øÓÐ³ÖÐø×´Ì¬ÐÅÏ¢µÄ¼üÖµÐÅºÅ
                          while (0 != touch_key)
                          {
                              delay_ms(10);
                              cnt++;
                              __tk_scan();
                              touch_key = __tk_key_flag;
              
                              if (cnt >= 87) // Ô­±¾ÊÇÌî90µÄ£¬µ«ÊÇÈí¼þÑÓÊ±ÓÐÎó²î£¬ÕâÀïÖ»ÄÜÂýÂýµ÷ÊÔ
                              {
                                  cnt = TK_LONG_KEY_TIME;
              #if USE_MY_DEBUG
                                  printf("k4 continue press\n");
              #endif
                                  send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY4);
                              }
                          }
              
                          // display_data ^= 0x0800; // ¶ÔÓ¦µÄLED×´Ì¬È¡·´£¬ºóÃæ»áµ÷ÓÃled_display()Ë¢ÐÂ
                          // led_display();          // LED×´Ì¬¸üÐÂÏÔÊ¾
                      }
                      else if (TK_CH15_VALIB == touch_key)
                      {
                          // Èç¹ûKEY5±»´¥Ãþ
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 8   

                          if (cnt >= TK_LONG_KEY_TIME && cnt < 90)
                          {
                              // display_data ^= 0x0800; // ¶ÔÓ¦µÄLED×´Ì¬È¡·´£¬ºóÃæ»áµ÷ÓÃled_display()Ë¢ÐÂ
                              // led_display();          // LED×´Ì¬¸üÐÂÏÔÊ¾
              #if USE_MY_DEBUG
                              printf("k5 long press\n");
              #endif
                              send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY5);
                          }
              
                          // Èô»¹²»ËÉ¿ªÊÖ£¬ÔòÃ¿¸ô150ms·¢ËÍÒ»´Î´øÓÐ³ÖÐø×´Ì¬ÐÅÏ¢µÄ¼üÖµÐÅºÅ
                          while (0 != touch_key)
                          {
                              delay_ms(10);
                              cnt++;
                              __tk_scan();
                              touch_key = __tk_key_flag;
              
                              if (cnt >= 87) // Ô­±¾ÊÇÌî90µÄ£¬µ«ÊÇÈí¼þÑÓÊ±ÓÐÎó²î£¬ÕâÀïÖ»ÄÜÂýÂýµ÷ÊÔ
                              {
                                  cnt = TK_LONG_KEY_TIME;
              #if USE_MY_DEBUG
                                  printf("k5 continue press\n");
              #endif
                                  send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY5);
                              }
                          }
              
                          // display_data ^= 0x0800; // ¶ÔÓ¦µÄLED×´Ì¬È¡·´£¬ºóÃæ»áµ÷ÓÃled_display()Ë¢ÐÂ
                          // led_display();          // LED×´Ì¬¸üÐÂÏÔÊ¾
                      }
                  }
                  else if (1 == flag_is_long_press && 0 == touch_key)
                  {
                      // Èç¹ûÖ®Ç°ÊÇ³¤°´£¬ÏÖÔÚÈ´ËÉ¿ªÁË°´¼ü
                      switch (KeyOld)
                      {
                      case TK_CH24_VALIB:
              #if USE_MY_DEBUG
                          printf("k1 long press loose\n");
              #endif
                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY1);
                          break;
              
                      case TK_CH25_VALIB:
              #if USE_MY_DEBUG
                          printf("k2 long press loose\n");
              #endif
                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY2);
                          break;
              
                      case TK_CH23_VALIB:
              #if USE_MY_DEBUG
                          printf("k3 long press loose\n");
              #endif
                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY3);
                          break;
              
                      case TK_CH17_VALIB:
              #if USE_MY_DEBUG
                          printf("k4 long press loose\n");
              #endif
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 9   

                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY4);
                          break;
              
                      case TK_CH15_VALIB:
              #if USE_MY_DEBUG
                          printf("k5 long press loose\n");
              #endif
                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY5);
                          break;
                      }
              
                      flag_is_long_press = 0; // Çå³ý±êÖ¾Î»
                      cnt = 0;
                      KeyOld = 0;
                  }
              
              #if 0
                  if (1 == __tk_long_key_flag) // Èç¹û³¤°´°´¼ü£¨Õâ¸ö¹¦ÄÜ²âÊÔ·¢ÏÖ²»ÐÐ£¬²»ÄÜÓÃ£©
                  {
                      __tk_long_key_flag = 0;
              
                      // ÕâÀï¿ÉÒÔ×Ô¼º´¦Àí£¬Ìí¼Ó×Ô¼ºÐèÒªµÄ¹¦ÄÜ
              
                      P11 = 0;
                  }
              #endif
              }
              #endif
 514          
 515          /**
 516           * @brief __is_double_click() ÅÐ¶ÏÊÇ·ñÓÐË«»÷Í¬Ò»¸ö´¥Ãþ°´¼ü,ÄÚ²¿×î³¤ÑÓÊ±Ê±¼ä£ºDETECT_DOUBLE_CLICK_INTERVAL
 517           *
 518           * @param touch_key_id_const
 519           * @return u8 0--Ã»ÓÐË«»÷Í¬Ò»¸ö´¥Ãþ°´¼ü£¬1--Ë«»÷ÁËÍ¬Ò»¸ö´¥Ãþ°´¼ü
 520           */
 521          u8 __is_double_click(const u32 touch_key_id_const)
 522          {
 523   1          u8 i = 0;                   // Ñ­»·¼ÆÊýÖµ
 524   1          volatile u32 touch_key = 0; // ´æ·ÅÃ¿´Î¼ì²âµ½µÄ°´¼ü
 525   1      
 526   1          for (; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
 527   1          {
 528   2              delay_ms(1);
 529   2              __tk_scan();
 530   2              touch_key = __tk_key_flag;
 531   2      
 532   2              if (touch_key_id_const == touch_key)
 533   2              {
 534   3                  // Èç¹û¼ì²âµ½ÊÇÍ¬Ò»¸ö°´¼ü°´ÏÂ£¬ËµÃ÷ÊÇË«»÷
 535   3                  return 1; // Ë«»÷ÁËÍ¬Ò»¸ö´¥Ãþ°´¼ü£¬·µ»Ø1
 536   3              }
 537   2          }
 538   1      
 539   1          return 0; // Ã»ÓÐË«»÷Í¬Ò»¸ö´¥Ãþ°´¼ü£¬·µ»Ø0
 540   1      }
 541          
 542          enum
 543          {
 544              TOUCH_KEY_SCAN_STATUS_NONE,                  // ¿Õ×´Ì¬£¬¼ì²âÊÇ·ñÓÐ°´¼ü°´ÏÂ
 545              TOUCH_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // ÕýÔÚ¼ì²âÊÇ·ñÎª³¤°´£¨Òª¸ú¼ì²â³¤°´×÷Çø·Ö£©
 546              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // ÕýÔÚ´¦Àí³¤°´
 547              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // ÕýÔÚ´¦Àí³¤°´³ÖÐø£¨²»ËÉÊÖ£©
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 10  

 548              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // ÕýÔÚ´¦Àí¶Ì°´
 549          
 550              TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // ÕýÔÚµÈ´ý¶Ì°´ËÉ¿ª
 551              TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // ÕýÔÚµÈ´ý³¤°´ËÉ¿ª
 552              TOUCH_KEY_SCAN_STATUS_IS_END,                      // ÊÕÎ²´¦Àí
 553          };
 554          
 555          static volatile u8 touch_key_scan_status = 0; // ·Ç×èÈûµÄ°´¼üÉ¨Ãèº¯ÊýÖÐ£¬Ê¹ÓÃµÄ×´Ì¬»ú
 556          
 557          // ·Ç×èÈûµÄ°´¼üÉ¨Ãèº¯Êý
 558          void touch_key_scan(void)
 559          {
 560   1          volatile u32 touch_key = 0;             // __tk_key_flag µ¥´Î°´¼ü±êÖ¾
 561   1          static u32 touch_key_last = 0;          // ÓÃÓÚ´æ·Å³¤°´Ê±£¬¶ÔÓ¦µÄ°´¼ü
 562   1          static volatile u32 touch_time_cnt = 0; // ³¤°´¼ÆÊýÖµ
 563   1      
 564   1          /* °´¼üÉ¨Ãèº¯Êý */
 565   1          __tk_scan();               // Ê¹ÓÃÁË¿âÀïÃæµÄ½Ó¿Ú£¨±ÕÔ´¿â£©
 566   1          touch_key = __tk_key_flag; // __tk_key_flag µ¥´Î°´¼ü±êÖ¾
 567   1      
 568   1          if (TOUCH_KEY_SCAN_STATUS_NONE == touch_key_scan_status) // Î´¼ì²âµ½°´¼üÊ±
 569   1          {
 570   2              // Èç¹ûÓÐ°´¼ü°´ÏÂ£¨²¢ÇÒÖ®Ç°É¨Ãèµ½µÄ²»ÊÇ³¤°´£©
 571   2              // if (touch_key && touch_time_cnt < LONG_PRESS_TIME_THRESHOLD_MS)
 572   2              // if (touch_key)
 573   2              // if (touch_key_last != touch_key && touch_key != 0)
 574   2              {
 575   3                  // ÅÐ¶ÏÊÇ·ñÎª³¤°´£º
 576   3      
 577   3                  if (touch_key_last == 0) // Èç¹ûÖ®Ç°Î´¼ì²âµ½°´¼ü
 578   3                  {
 579   4                      touch_key_last = touch_key;
 580   4                  }
 581   3                  else if (touch_key_last == touch_key)
 582   3                  {
 583   4                      // Èç¹ûÉÏ´Î¼ì²âµ½µÄ°´¼üÓë´Ë´ÎµÄ°´¼üÏàµÈ£¬ËµÃ÷°´¼ü»¹Î´ËÉ¿ª
 584   4                      touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
 585   4      
 586   4                      if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
 587   4                      {
 588   5                          // Èç¹û³¤°´³¬¹ýÁËÉèÖÃµÄ³¤°´Ê±¼ä
 589   5                          // Ìø×ªµ½³¤°´´¦Àí
 590   5                          touch_time_cnt = 0; // Çå³ý³¤°´Ê±¼ä¼ÆÊý
 591   5      
 592   5                          printf("long press\n");
 593   5                          touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
 594   5                      }
 595   4                  }
 596   3                  else
 597   3                  {
 598   4                      // Èç¹ûÉÏ´Î¼ì²âµ½µÄ°´¼üÓë´Ë´ÎµÄ°´¼ü²»ÏàµÈ£¬²¢ÇÒÉÏ´Î¼ì²âµ½µÄ°´¼ü²»µÈÓÚ0
 599   4                      // touch_time_cnt = 0; // Çå³ý³¤°´Ê±¼ä¼ÆÊý£¨¿ÉÒÔÁôµ½ÊÕÎ²´¦Àí£©
 600   4      
 601   4                      // Ìø×ªµ½¶Ì°´´¦Àí
 602   4                      touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
 603   4      
 604   4                      // printf("short press\n");
 605   4                  }
 606   3      
 607   3                  delay_ms(1); //
 608   3              }
 609   2          }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 11  

 610   1      
 611   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == touch_key_scan_status)
 612   1          {
 613   2              // Èç¹ûÊÇÕýÔÚ´¦Àí¶Ì°´
 614   2              bit flag_is_double_click = 0; // ±êÖ¾Î»£¬ÊÇ·ñÓÐ°´¼üË«»÷
 615   2      
 616   2              if (TOUCH_KEY_ID_1 == touch_key_last)
 617   2              {
 618   3                  // Èç¹ûKEY1±»´¥Ãþ
 619   3                  flag_is_double_click = __is_double_click(touch_key_last);
 620   3                  if (flag_is_double_click)
 621   3                  {
 622   4                      // Èç¹ûÓÐ°´¼üË«»÷
 623   4      #if USE_MY_DEBUG
 624   4                      printf("k1 double press\n");
 625   4      #endif
 626   4                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY1); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 627   4                  }
 628   3                  else
 629   3                  {
 630   4                      // Èç¹ûÃ»ÓÐ°´¼üË«»÷£¬ËµÃ÷ÊÇ¶Ì°´
 631   4      #if USE_MY_DEBUG
 632   4                      printf("k1 press\n");
 633   4      #endif
 634   4                      send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY1); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 635   4                  }
 636   3      
 637   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // µÈ´ý°´¼üËÉ¿ª
 638   3              }
 639   2              else if (TOUCH_KEY_ID_2 == touch_key_last)
 640   2              {
 641   3                  // Èç¹ûKEY2±»´¥Ãþ
 642   3                  flag_is_double_click = __is_double_click(touch_key_last);
 643   3                  if (flag_is_double_click)
 644   3                  {
 645   4                      // Èç¹ûÓÐ°´¼üË«»÷
 646   4      #if USE_MY_DEBUG
 647   4                      printf("k2 double press\n");
 648   4      #endif
 649   4                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY2); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 650   4                  }
 651   3                  else
 652   3                  {
 653   4                      // Èç¹ûÃ»ÓÐ°´¼üË«»÷£¬ËµÃ÷ÊÇ¶Ì°´
 654   4      #if USE_MY_DEBUG
 655   4                      printf("k2 press\n");
 656   4      #endif
 657   4                      send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY2); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 658   4                  }
 659   3      
 660   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // µÈ´ý°´¼üËÉ¿ª
 661   3              }
 662   2              else if (TOUCH_KEY_ID_3 == touch_key_last)
 663   2              {
 664   3                  // Èç¹ûKEY3±»´¥Ãþ
 665   3                  flag_is_double_click = __is_double_click(touch_key_last);
 666   3                  if (flag_is_double_click)
 667   3                  {
 668   4                      // Èç¹ûÓÐ°´¼üË«»÷
 669   4      #if USE_MY_DEBUG
 670   4                      printf("k3 double press\n");
 671   4      #endif
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 12  

 672   4                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY3); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 673   4                  }
 674   3                  else
 675   3                  {
 676   4                      // Èç¹ûÃ»ÓÐ°´¼üË«»÷£¬ËµÃ÷ÊÇ¶Ì°´
 677   4      #if USE_MY_DEBUG
 678   4                      printf("k3 press\n");
 679   4      #endif
 680   4                      send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY3); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 681   4                  }
 682   3      
 683   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // µÈ´ý°´¼üËÉ¿ª
 684   3              }
 685   2              else if (TOUCH_KEY_ID_4 == touch_key_last)
 686   2              {
 687   3                  // Èç¹ûKEY4±»´¥Ãþ
 688   3                  flag_is_double_click = __is_double_click(touch_key_last);
 689   3                  if (flag_is_double_click)
 690   3                  {
 691   4                      // Èç¹ûÓÐ°´¼üË«»÷
 692   4      #if USE_MY_DEBUG
 693   4                      printf("k4 double press\n");
 694   4      #endif
 695   4                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY4); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 696   4                  }
 697   3                  else
 698   3                  {
 699   4                      // Èç¹ûÃ»ÓÐ°´¼üË«»÷£¬ËµÃ÷ÊÇ¶Ì°´
 700   4      #if USE_MY_DEBUG
 701   4                      printf("k4 press\n");
 702   4      #endif
 703   4                      send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY4); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 704   4                  }
 705   3      
 706   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // µÈ´ý°´¼üËÉ¿ª
 707   3              }
 708   2              else if (TOUCH_KEY_ID_5 == touch_key_last)
 709   2              {
 710   3                  // Èç¹ûKEY5±»´¥Ãþ
 711   3                  flag_is_double_click = __is_double_click(touch_key_last);
 712   3                  if (flag_is_double_click)
 713   3                  {
 714   4                      // Èç¹ûÓÐ°´¼üË«»÷
 715   4      #if USE_MY_DEBUG
 716   4                      printf("k5 double press\n");
 717   4      #endif
 718   4                      send_status_keyval(KEY_PRESS_DOUBLECLICK, TOUCH_KEY5); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 719   4                  }
 720   3                  else
 721   3                  {
 722   4                      // Èç¹ûÃ»ÓÐ°´¼üË«»÷£¬ËµÃ÷ÊÇ¶Ì°´
 723   4      #if USE_MY_DEBUG
 724   4                      printf("k5 press\n");
 725   4      #endif
 726   4                      send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY5); // ·¢ËÍ´øÓÐ×´Ì¬µÄ¼üÖµ
 727   4                  }
 728   3      
 729   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // µÈ´ý°´¼üËÉ¿ª
 730   3              }
 731   2          }
 732   1      
 733   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == touch_key_scan_status)
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 13  

 734   1          {
 735   2              // ´¦Àí³¤°´
 736   2              if (TOUCH_KEY_ID_1 == touch_key)
 737   2              {
 738   3                  // Èç¹ûKEY1±»´¥Ãþ
 739   3      
 740   3      #if USE_MY_DEBUG
 741   3                  printf("k1 long press\n");
 742   3      #endif
 743   3                  send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY1);
 744   3              }
 745   2              else if (TOUCH_KEY_ID_2 == touch_key)
 746   2              {
 747   3                  // Èç¹ûKEY2±»´¥Ãþ
 748   3      
 749   3      #if USE_MY_DEBUG
 750   3                  printf("k2 long press\n");
 751   3      #endif
 752   3                  send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY2);
 753   3              }
 754   2              else if (TOUCH_KEY_ID_3 == touch_key)
 755   2              {
 756   3                  // Èç¹ûKEY3±»´¥Ãþ
 757   3      
 758   3      #if USE_MY_DEBUG
 759   3                  printf("k3 long press\n");
 760   3      #endif
 761   3                  send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY3);
 762   3              }
 763   2              else if (TOUCH_KEY_ID_4 == touch_key)
 764   2              {
 765   3                  // Èç¹ûKEY4±»´¥Ãþ
 766   3      
 767   3      #if USE_MY_DEBUG
 768   3                  printf("k4 long press\n");
 769   3      #endif
 770   3                  send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY4);
 771   3              }
 772   2              else if (TOUCH_KEY_ID_5 == touch_key)
 773   2              {
 774   3                  // Èç¹ûKEY5±»´¥Ãþ
 775   3      
 776   3      #if USE_MY_DEBUG
 777   3                  printf("k5 long press\n");
 778   3      #endif
 779   3                  send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY5);
 780   3              }
 781   2      
 782   2              touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // Ìø×ªµ½³¤°´³ÖÐø
 783   2          }
 784   1      
 785   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == touch_key_scan_status)
 786   1          {
 787   2              // ´¦Àí³¤°´³ÖÐø
 788   2      
 789   2              if (touch_key_last == touch_key)
 790   2              {
 791   3                  touch_time_cnt++;
 792   3                  if (TOUCH_KEY_ID_1 == touch_key)
 793   3                  {
 794   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 795   4                      {
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 14  

 796   5                          touch_time_cnt = 0;
 797   5      #if USE_MY_DEBUG
 798   5                          printf("k1 continue press\n");
 799   5      #endif
 800   5                          send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY1);
 801   5                      }
 802   4                  }
 803   3                  else if (TOUCH_KEY_ID_2 == touch_key)
 804   3                  {
 805   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 806   4                      {
 807   5                          touch_time_cnt = 0;
 808   5      #if USE_MY_DEBUG
 809   5                          printf("k2 continue press\n");
 810   5      #endif
 811   5                          send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY2);
 812   5                      }
 813   4                  }
 814   3                  else if (TOUCH_KEY_ID_3 == touch_key)
 815   3                  {
 816   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 817   4                      {
 818   5                          touch_time_cnt = 0;
 819   5      #if USE_MY_DEBUG
 820   5                          printf("k3 continue press\n");
 821   5      #endif
 822   5                          send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY3);
 823   5                      }
 824   4                  }
 825   3                  else if (TOUCH_KEY_ID_4 == touch_key)
 826   3                  {
 827   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 828   4                      {
 829   5                          touch_time_cnt = 0;
 830   5      #if USE_MY_DEBUG
 831   5                          printf("k4 continue press\n");
 832   5      #endif
 833   5                          send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY4);
 834   5                      }
 835   4                  }
 836   3                  else if (TOUCH_KEY_ID_5 == touch_key)
 837   3                  {
 838   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 839   4                      {
 840   5                          touch_time_cnt = 0;
 841   5      #if USE_MY_DEBUG
 842   5                          printf("k5 continue press\n");
 843   5      #endif
 844   5                          send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY5);
 845   5                      }
 846   4                  }
 847   3      
 848   3                  delay_ms(1);
 849   3              }
 850   2              else
 851   2              {
 852   3                  // Èç¹ûÖ®Ç°¼ì²âµ½µÄ°´¼üÓëµ±Ç°¼ì²âµ½µÄ°´¼ü²»Ò»ÖÂ£¬
 853   3                  // ËµÃ÷ ¿ÉÄÜËÉ¿ªÁËÊÖ »òÊÇ Ò»Ö»ÊÖ°´×¡ÁËÔ­À´µÄ°´¼üÁíÒ»Ö»ÊÖ°´ÁËÆäËû°´¼ü
 854   3      
 855   3                  // Ìø×ªµ½µÈ´ý³¤°´ËÉ¿ª
 856   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
 857   3              }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 15  

 858   2          }
 859   1      
 860   1          if ((TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status) ||
 861   1              (TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == touch_key_scan_status))
 862   1          {
 863   2              // Èç¹ûÊÇµÈ´ý°´¼üËÉ¿ª
 864   2              static volatile u16 loose_cnt = 0; // ´æ·ÅËÉÊÖ¼ÆÊýÖµ
 865   2      
 866   2              if (touch_key == 0)
 867   2              {
 868   3                  loose_cnt++;
 869   3                  delay_ms(1);
 870   3              }
 871   2              else
 872   2              {
 873   3                  // Ö»ÒªÓÐÒ»´Î¼ì²âµ½°´¼ü£¬ËµÃ÷Ã»ÓÐËÉ¿ªÊÖ
 874   3                  loose_cnt = 0;
 875   3              }
 876   2      
 877   2              if (loose_cnt >= LOOSE_PRESS_CNT_MS) // ÕâÀïµÄ±È½ÏÖµÐèÒª×¢Òâ£¬²»ÄÜ´óÓÚ±äÁ¿ÀàÐÍ¶ÔÓ¦µÄ×î´óÖµ
 878   2              {
 879   3                  loose_cnt = 0; // Çå¿ÕËÉÊÖ¼ÆÊý
 880   3                  // Èç¹û xx msÄÚÃ»ÓÐ¼ì²âµ½°´¼ü°´ÏÂ£¬ËµÃ÷ÒÑ¾­ËÉ¿ªÊÖ
 881   3      
 882   3                  if (TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status)
 883   3                  {
 884   4                      if (TOUCH_KEY_ID_1 == touch_key_last)
 885   4                      {
 886   5      #if USE_MY_DEBUG
 887   5                          printf("k1 long press loose\n");
 888   5      #endif
 889   5                          send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY1);
 890   5                      }
 891   4                  }
 892   3      
 893   3      
 894   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_END; // Ìø×ªµ½ÊÕÎ²´¦Àí
 895   3              }
 896   2          }
 897   1      
 898   1          if (TOUCH_KEY_SCAN_STATUS_IS_END == touch_key_scan_status)
 899   1          {
 900   2              // ÊÕÎ²´¦Àí
 901   2              touch_key = 0;
 902   2              touch_key_last = 0;
 903   2              touch_time_cnt = 0;
 904   2      
 905   2              touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_NONE;
 906   2          }
 907   1      }
 908          
 909          /*************************** (C) COPYRIGHT 2022 TAIXIN-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1580    ----
   CONSTANT SIZE    =    338    ----
   XDATA SIZE       =     11      13
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
C51 COMPILER V9.60.7.0   TK_USER                                                           11/13/2024 17:56:04 PAGE 16  

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
